<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>CSV è³‡æ–™è®€å–èˆ‡çµæ§‹å»ºç«‹</title>
</head>
<body>
  <h1>é–‹ç™¼è€…è«‹æ‰“é–‹ Console çœ‹è³‡æ–™çµæ§‹ï¼</h1>

  <script>
    // Google Sheets CSV é€£çµ
    const investorCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRQlSijrrBhnnI9iHyYLdFhiV_ykLNwQhOQ3QSeIAXP6ZCn-1r03oov2AvjL6W_AwvL0QRIYZ-W-3nB/pub?gid=856920333&single=true&output=csv';
    const priceCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRQlSijrrBhnnI9iHyYLdFhiV_ykLNwQhOQ3QSeIAXP6ZCn-1r03oov2AvjL6W_AwvL0QRIYZ-W-3nB/pub?gid=0&single=true&output=csv';

    // è‚¡ç¥¨åƒ¹æ ¼è³‡æ–™: { 2330: { init: xxx, current: xxx }, ... }
    const priceData = {};

    // æŠ•è³‡äººè³‡æ–™: { è±ª: [{ percent: 30, stock: "PLTR" }, ...], ... }
    const investorData = {};

    async function fetchCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      return text.trim().split('\n').map(row => {
        // æ”¯æ´ç”¨é€—è™Ÿåˆ†éš”ä½†åŒ…å«å¼•è™Ÿçš„æ ¼å¼
        const match = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
        return match ? match.map(v => v.replace(/^"|"$/g, '')) : [];
      });
    }

    async function main() {
      // ä¸‹è¼‰ CSV
      const rawPrice = await fetchCSV(priceCSV);
      const rawInvestor = await fetchCSV(investorCSV);

      // 1. è§£æ price CSV
      for (let i = 1; i < rawPrice.length; i++) {
        const [stock, priceInit, priceCurrent] = rawPrice[i];
        if (!stock || !priceInit || !priceCurrent) continue;
        const symbol = stock.trim().toUpperCase();
        priceData[symbol] = {
          init: parseFloat(priceInit),
          current: parseFloat(priceCurrent)
        };
      }

      // 2. è§£æ investor CSV
      for (let i = 1; i < rawInvestor.length; i++) {
        const [name, rawHoldings] = rawInvestor[i];
        if (!name || !rawHoldings) continue;

        const lines = rawHoldings.split('\n');
        investorData[name.trim()] = [];

        for (const line of lines) {
          const match = line.trim().match(/^(\d+)%\s+(.+)$/);
          if (match) {
            const percent = parseFloat(match[1]);
            const stock = match[2].trim().toUpperCase();
            investorData[name.trim()].push({ percent, stock });
          }
        }
      }

      // 3. å°å‡ºè³‡æ–™çµæ§‹
      console.log('ğŸ“Š åƒ¹æ ¼è³‡æ–™ (priceData):', priceData);
      console.log('ğŸ‘¤ æŠ•è³‡äººè³‡æ–™ (investorData):', investorData);
    }

    main();
  </script>
</body>
</html>
