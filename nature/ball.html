<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å½ˆç ç¢°æ’éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #f0f0f0;
    }

    canvas {
      display: block;
      background-color: #f0f0f0;
    }

    .controls {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      color: #333;
    }

    .controls button {
      padding: 10px;
      margin: 5px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }

    .controls button:hover {
      background-color: #45a049;
    }

    .controls select {
      padding: 5px;
      margin: 5px;
      font-size: 14px;
    }

    .dashboard {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 10;
      color: #333;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
      max-height: 80%;
      overflow-y: auto;
      font-size: 14px;
    }

    .dashboard .ball-info {
      margin-bottom: 10px;
    }

    .dashboard button {
      background-color: #ff5722;
      color: white;
      border: none;
      padding: 5px;
      border-radius: 5px;
      cursor: pointer;
    }

    .dashboard button:hover {
      background-color: #e64a19;
    }

    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px;
      border-radius: 3px;
      pointer-events: none;
      font-size: 14px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="resetBtn">é‡è¨­ç•«é¢</button>
    <button id="addBallBtn">æ–°å¢å½ˆç </button>
    <select id="ballSelector">
      <option value="ğŸ’©">ğŸ’© å½ˆç </option>
      <option value="ğŸ°">ğŸ° å½ˆç </option>
      <option value="ğŸ£">ğŸ£ å½ˆç </option>
      <option value="ğŸ¤”ï¸">ğŸ¤”ï¸ å½ˆç </option>
      <option value="ğŸ§">ğŸ§ å½³ç </option>
    </select>
  </div>

  <div class="dashboard" id="dashboard">
    <button id="toggleDashboardBtn">æ”¶åˆå„€è¡¨æ¿</button>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const balls = [];
    let selectedBall = 'ğŸ’©';
    let tooltip = document.getElementById('tooltip');

    // ç•¶å‰é¸æ“‡çš„å½ˆç 
    document.getElementById('ballSelector').addEventListener('change', function () {
      selectedBall = this.value;
    });

    // é‡è¨­éŠæˆ²
    document.getElementById('resetBtn').addEventListener('click', resetGame);

    // æ–°å¢å½ˆç æŒ‰éˆ•
    document.getElementById('addBallBtn').addEventListener('click', function() {
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height;
      addBall(x, y);
    });

    // å„€è¡¨æ¿æ”¶åˆ/é¡¯ç¤º
    let dashboardVisible = true;
    document.getElementById('toggleDashboardBtn').addEventListener('click', function() {
      dashboardVisible = !dashboardVisible;
      document.getElementById('dashboard').style.display = dashboardVisible ? 'block' : 'none';
    });

    function resetGame() {
      balls.length = 0; // æ¸…ç©ºå½ˆç 
    }

    // å½ˆç é¡åˆ¥
    class Ball {
      constructor(x, y, size, symbol) {
        this.x = x;
        this.y = y;
        this.size = size;
        this.originalSize = size; // è¨˜éŒ„åŸå§‹å¤§å°
        this.symbol = symbol;
        this.velocityX = Math.random() * 4 + 2; // éš¨æ©Ÿåˆå§‹é€Ÿåº¦
        this.velocityY = Math.random() * 4 + 2; // éš¨æ©Ÿåˆå§‹é€Ÿåº¦
        this.angle = Math.random() * Math.PI * 2; // éš¨æ©Ÿæ–¹å‘
        this.velocityX = Math.cos(this.angle) * this.velocityX;
        this.velocityY = Math.sin(this.angle) * this.velocityY;
        this.acceleration = 1.05; // æ¯æ¬¡é»æ“ŠåŠ é€Ÿå€æ•¸
        this.minSpeed = 0.5; // æœ€å°é€Ÿåº¦ï¼Œé˜²æ­¢åœä¸‹ä¾†
        this.sizeMultiplier = 1; // å¤§å°å€æ•¸
        this.collisions = 0; // ç¢°æ’æ¬¡æ•¸
        this.isAngry = false; // ç‹‚æš´æ¨¡å¼
        this.rotationAngle = 0; // è‡ªè½‰è§’åº¦
        this.angryStartTime = null; // ç‹‚æš´æ¨¡å¼é–‹å§‹æ™‚é–“
        this.angryModeDuration = 60000; // ç‹‚æš´æ¨¡å¼æŒçºŒä¸€åˆ†é˜
        this.isInAngryMode = false; // ç‹‚æš´æ¨¡å¼ç‹€æ…‹
        this.originalVelocityX = this.velocityX;
        this.originalVelocityY = this.velocityY;
        this.index = balls.length + 1; // å½ˆç ç·¨è™Ÿ
      }

      update() {
        // ç¢ºä¿å½ˆç çš„é€Ÿåº¦ä¸ç‚º0
        if (Math.abs(this.velocityX) < this.minSpeed) {
          this.velocityX = Math.sign(this.velocityX) * this.minSpeed;
        }
        if (Math.abs(this.velocityY) < this.minSpeed) {
          this.velocityY = Math.sign(this.velocityY) * this.minSpeed;
        }

        // ç‹‚æš´æ¨¡å¼: é€Ÿåº¦æå‡å…©å€ï¼Œæœ€å¤šå…©å€
        if (this.isInAngryMode) {
          this.velocityX = Math.min(this.originalVelocityX * 2, this.velocityX);
          this.velocityY = Math.min(this.originalVelocityY * 2, this.velocityY);
          this.symbol = 'ğŸ˜¡'; // ç‹‚æš´æ¨¡å¼é¡¯ç¤ºç”Ÿæ°£
        }

        this.x += this.velocityX;
        this.y += this.velocityY;

        // å¦‚æœç¢°åˆ°é‚Šç•Œåå½ˆ
        if (this.x + this.size > canvas.width || this.x - this.size < 0) {
          this.velocityX = -this.velocityX;
          this.x = Math.min(Math.max(this.x, this.size), canvas.width - this.size);
        }
        if (this.y + this.size > canvas.height || this.y - this.size < 0) {
          this.velocityY = -this.velocityY;
          this.y = Math.min(Math.max(this.y, this.size), canvas.height - this.size);
        }

        // å¦‚æœç‹‚æš´æ¨¡å¼è¶…éä¸€åˆ†é˜ï¼Œæ¢å¾©æ­£å¸¸
        if (this.isInAngryMode && Date.now() - this.angryStartTime > this.angryModeDuration) {
          this.isInAngryMode = false;
          this.symbol = 'ğŸ’©'; // æ¢å¾©ç‚ºåŸä¾†çš„å½ˆç æ¨£å¼
          this.velocityX = this.originalVelocityX; // æ¢å¾©åŸé€Ÿåº¦
          this.velocityY = this.originalVelocityY; // æ¢å¾©åŸé€Ÿåº¦
        }

        this.draw();
      }

      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotationAngle); // è‡ªè½‰

        ctx.font = `${this.size}px sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(this.symbol, 0, 0);
        ctx.restore();
      }

      // åŠ é€Ÿ
      accelerate() {
        const randomFactor = Math.random() * 2 + 1; // éš¨æ©ŸåŠ é€Ÿå› å­
        this.velocityX *= randomFactor;
        this.velocityY *= randomFactor;
      }

      // ç¢°æ’æª¢æ¸¬
      checkCollision(otherBall) {
        const dx = this.x - otherBall.x;
        const dy = this.y - otherBall.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        const collisionDistance = this.size + otherBall.size - 5; // èª¿æ•´ç¢°æ’ç¯„åœï¼Œä½¿ç¢°æ’æ›´éˆæ•
        if (distance < collisionDistance) {
          this.collisions++; // å¢åŠ ç¢°æ’æ¬¡æ•¸

          // å¦‚æœç¢°æ’æ¬¡æ•¸è¶…é 10 æ¬¡ï¼Œé€²å…¥ç‹‚æš´æ¨¡å¼
          if (this.collisions > 10 && !this.isInAngryMode) {
            this.isInAngryMode = true;
            this.angryStartTime = Date.now(); // è¨˜éŒ„ç‹‚æš´æ¨¡å¼é–‹å§‹æ™‚é–“
          }

          // è‡ªè½‰ç‰¹æ•ˆï¼šåœ¨ç¢°æ’æ™‚å„ªé›…åœ°è‡ªè½‰
          this.rotationAngle += Math.PI / 8; // æ¯æ¬¡ç¢°æ’æ™‚è½‰å‹•ä¸€å°æ®µ

          // åŸºæœ¬çš„ç¢°æ’åæ‡‰ï¼šç°¡å–®äº¤æ›é€Ÿåº¦
          const angle = Math.atan2(dy, dx);
          const targetVx = Math.cos(angle) * Math.abs(this.velocityX);
          const targetVy = Math.sin(angle) * Math.abs(this.velocityY);
          this.velocityX = targetVx;
          this.velocityY = targetVy;

          // åœ¨ç¢°æ’å¾Œç¨å¾®èª¿æ•´å½ˆç çš„é‹å‹•æ–¹å‘å’Œé€Ÿåº¦
          this.handleBounce(dx, dy, otherBall);
        }
      }

      handleBounce(dx, dy, otherBall) {
        // ä¿®æ­£ä½ç½®ä¸¦ç¢ºä¿ä¸æœƒå¡ä½
        const overlap = this.size + otherBall.size - Math.sqrt(dx * dx + dy * dy);
        const normalizeX = dx / Math.abs(dx);
        const normalizeY = dy / Math.abs(dy);
        this.x += normalizeX * overlap / 2;
        this.y += normalizeY * overlap / 2;
        otherBall.x -= normalizeX * overlap / 2;
        otherBall.y -= normalizeY * overlap / 2;
      }
    }

    // é»æ“Šå½ˆç åŠ é€Ÿ
    canvas.addEventListener('click', function (event) {
      for (let i = 0; i < balls.length; i++) {
        const ball = balls[i];
        const dx = event.clientX - ball.x;
        const dy = event.clientY - ball.y;
        if (Math.sqrt(dx * dx + dy * dy) < ball.size) {
          ball.accelerate(); // åŠ é€Ÿ
        }
      }
    });

    // æ–°å¢å½ˆç 
    function addBall(x, y) {
      const ball = new Ball(x, y, 20, selectedBall);
      balls.push(ball);
    }

    // æ›´æ–°éŠæˆ²
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      for (let i = 0; i < balls.length; i++) {
        const ball = balls[i];
        ball.update();
        
        // æª¢æŸ¥æ¯å€‹å½ˆç èˆ‡å…¶ä»–å½ˆç çš„ç¢°æ’
        for (let j = i + 1; j < balls.length; j++) {
          const otherBall = balls[j];
          ball.checkCollision(otherBall);
        }
      }

      updateDashboard(); // æ›´æ–°å„€è¡¨æ¿
      requestAnimationFrame(gameLoop);
    }

    // æ›´æ–°å½ˆç å„€è¡¨æ¿
    function updateDashboard() {
      const dashboard = document.getElementById('dashboard');
      dashboard.innerHTML = `
        <button id="toggleDashboardBtn">æ”¶åˆå„€è¡¨æ¿</button>
      `;
      
      balls.forEach((ball, index) => {
        const ballInfo = document.createElement('div');
        ballInfo.classList.add('ball-info');
        ballInfo.innerHTML = `
          <strong>å½ˆç  ${ball.index}:</strong><br>
          é€Ÿåº¦: (${ball.velocityX.toFixed(2)}, ${ball.velocityY.toFixed(2)})<br>
          ç¢°æ’æ¬¡æ•¸: ${ball.collisions}<br>
          ç‹‚æš´æ¨¡å¼: ${ball.isInAngryMode ? 'æ˜¯' : 'å¦'}
        `;
        dashboard.appendChild(ballInfo);
      });
    }

    // é¼ æ¨™è§¸ç™¼é¡¯ç¤ºå½ˆç ç·¨è™Ÿ
    canvas.addEventListener('mousemove', function(event) {
      let hoveredBall = null;
      for (let i = 0; i < balls.length; i++) {
        const ball = balls[i];
        const dx = event.clientX - ball.x;
        const dy = event.clientY - ball.y;
        if (Math.sqrt(dx * dx + dy * dy) < ball.size) {
          hoveredBall = ball;
          break;
        }
      }
      if (hoveredBall) {
        tooltip.innerHTML = `å½ˆç  ${hoveredBall.index}`;
        tooltip.style.display = 'block';
        tooltip.style.left = `${event.clientX + 10}px`;
        tooltip.style.top = `${event.clientY + 10}px`;
      } else {
        tooltip.style.display = 'none';
      }
    });

    // é–‹å§‹éŠæˆ²å¾ªç’°
    gameLoop();
  </script>
</body>
</html>
