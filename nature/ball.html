<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å½ˆç ç¢°æ’éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #f0f0f0;
    }

    canvas {
      display: block;
      background-color: #f0f0f0;
    }

    .controls {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      color: #333;
    }

    .controls button {
      padding: 10px;
      margin: 5px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
    }

    .controls button:hover {
      background-color: #45a049;
    }

    .controls select {
      padding: 5px;
      margin: 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="resetBtn">é‡è¨­ç•«é¢</button>
    <button id="addBallBtn">æ–°å¢å½ˆç </button>
    <select id="ballSelector">
      <option value="ğŸ’©">ğŸ’© å½ˆç </option>
      <option value="ğŸ°">ğŸ° å½ˆç </option>
      <option value="ğŸ£">ğŸ£ å½ˆç </option>
      <option value="ğŸ¤”ï¸">ğŸ¤”ï¸ å½ˆç </option>
      <option value="ğŸ§">ğŸ§ å½ˆç </option>
    </select>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const balls = [];
    let selectedBall = 'ğŸ’©';

    // ç•¶å‰é¸æ“‡çš„å½ˆç 
    document.getElementById('ballSelector').addEventListener('change', function () {
      selectedBall = this.value;
    });

    // é‡è¨­éŠæˆ²
    document.getElementById('resetBtn').addEventListener('click', resetGame);

    // æ–°å¢å½ˆç æŒ‰éˆ•
    document.getElementById('addBallBtn').addEventListener('click', function() {
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height;
      addBall(x, y);
    });

    function resetGame() {
      balls.length = 0; // æ¸…ç©ºå½ˆç 
    }

    // å½ˆç é¡åˆ¥
    class Ball {
      constructor(x, y, size, symbol) {
        this.x = x;
        this.y = y;
        this.size = size;
        this.symbol = symbol;
        this.originalSize = size; // è¨˜éŒ„åŸå§‹å¤§å°
        this.velocityX = Math.random() * 4 + 2; // éš¨æ©Ÿåˆå§‹é€Ÿåº¦
        this.velocityY = Math.random() * 4 + 2; // éš¨æ©Ÿåˆå§‹é€Ÿåº¦
        this.angle = Math.random() * Math.PI * 2; // éš¨æ©Ÿæ–¹å‘
        this.velocityX = Math.cos(this.angle) * this.velocityX;
        this.velocityY = Math.sin(this.angle) * this.velocityY;
        this.acceleration = 1.05; // æ¯æ¬¡é»æ“ŠåŠ é€Ÿå€æ•¸
        this.minSpeed = 0.5; // æœ€å°é€Ÿåº¦ï¼Œé˜²æ­¢åœä¸‹ä¾†
        this.sizeMultiplier = 1; // å¤§å°å€æ•¸
        this.sizeIncrease = 1.5; // ç¢°æ’æ™‚æ”¾å¤§çš„å¤§å°
        this.sizeTimer = 0; // ç”¨ä¾†è¨ˆç®—æ”¾å¤§ç‰¹æ•ˆæ™‚é–“
      }

      update() {
        // ç¢ºä¿å½ˆç çš„é€Ÿåº¦ä¸ç‚º0
        if (Math.abs(this.velocityX) < this.minSpeed) {
          this.velocityX = Math.sign(this.velocityX) * this.minSpeed;
        }
        if (Math.abs(this.velocityY) < this.minSpeed) {
          this.velocityY = Math.sign(this.velocityY) * this.minSpeed;
        }

        this.x += this.velocityX;
        this.y += this.velocityY;

        // å¦‚æœç¢°åˆ°é‚Šç•Œåå½ˆ
        if (this.x + this.size > canvas.width || this.x - this.size < 0) {
          this.velocityX = -this.velocityX;
          this.x = Math.min(Math.max(this.x, this.size), canvas.width - this.size);
        }
        if (this.y + this.size > canvas.height || this.y - this.size < 0) {
          this.velocityY = -this.velocityY;
          this.y = Math.min(Math.max(this.y, this.size), canvas.height - this.size);
        }

        // è™•ç†æ”¾å¤§ç‰¹æ•ˆæ™‚é–“
        if (this.sizeTimer > 0) {
          this.sizeTimer -= 0.1;
          this.size = this.originalSize * this.sizeMultiplier * (1 + (this.sizeTimer / 100));
        } else {
          this.size = this.originalSize * this.sizeMultiplier;
        }

        this.draw();
      }

      draw() {
        ctx.font = `${this.size}px sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(this.symbol, this.x, this.y);
      }

      // åŠ é€Ÿ
      accelerate() {
        const randomFactor = Math.random() * 2 + 1; // éš¨æ©ŸåŠ é€Ÿå› å­
        this.velocityX *= randomFactor;
        this.velocityY *= randomFactor;
      }

      // ç¢°æ’æª¢æ¸¬
      checkCollision(otherBall) {
        const dx = this.x - otherBall.x;
        const dy = this.y - otherBall.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        if (distance < this.size + otherBall.size) {
          // ç¢°æ’æ™‚æ”¾å¤§
          this.sizeTimer = 100; // è¨­ç½®æ”¾å¤§æ™‚é–“
          otherBall.sizeTimer = 100; // è¨­ç½®å°æ–¹æ”¾å¤§æ™‚é–“

          // åŸºæœ¬çš„ç¢°æ’åæ‡‰ï¼šç°¡å–®äº¤æ›é€Ÿåº¦
          const angle = Math.atan2(dy, dx);
          const targetVx = Math.cos(angle) * Math.abs(this.velocityX);
          const targetVy = Math.sin(angle) * Math.abs(this.velocityY);
          this.velocityX = targetVx;
          this.velocityY = targetVy;

          // åœ¨ç¢°æ’å¾Œç¨å¾®èª¿æ•´å½ˆç çš„é‹å‹•æ–¹å‘å’Œé€Ÿåº¦
          this.handleBounce(dx, dy, otherBall);
        }
      }

      handleBounce(dx, dy, otherBall) {
        // ä¿®æ­£ä½ç½®ä¸¦ç¢ºä¿ä¸æœƒå¡ä½
        const overlap = this.size + otherBall.size - Math.sqrt(dx * dx + dy * dy);
        const normalizeX = dx / Math.abs(dx);
        const normalizeY = dy / Math.abs(dy);
        this.x += normalizeX * overlap / 2;
        this.y += normalizeY * overlap / 2;
        otherBall.x -= normalizeX * overlap / 2;
        otherBall.y -= normalizeY * overlap / 2;
      }
    }

    // é»æ“Šå½ˆç åŠ é€Ÿ
    canvas.addEventListener('click', (e) => {
      for (const ball of balls) {
        const dist = Math.sqrt(Math.pow(ball.x - e.x, 2) + Math.pow(ball.y - e.y, 2));
        if (dist < ball.size) {
          ball.accelerate();  // é»æ“Šå½ˆç åŠ é€Ÿ
          ball.sizeTimer = 100; // é»æ“Šæ™‚ç¬é–“æ”¾å¤§
        }
      }
    });

    // æ–°å¢å½ˆç 
    function addBall(x, y) {
      const size = Math.random() * 20 + 20;  // éš¨æ©Ÿå¤§å°
      const ball = new Ball(x, y, size, selectedBall);
      balls.push(ball);
    }

    // æ›´æ–°éŠæˆ²ç•«é¢
    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // æª¢æŸ¥å½ˆç ä¹‹é–“çš„ç¢°æ’
      for (let i = 0; i < balls.length; i++) {
        for (let j = i + 1; j < balls.length; j++) {
          balls[i].checkCollision(balls[j]);
        }
      }

      for (const ball of balls) {
        ball.update();
      }

      requestAnimationFrame(update);
    }

    update();  // é–‹å§‹éŠæˆ²å¾ªç’°

  </script>
</body>
</html>
